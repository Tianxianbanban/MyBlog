##  Android屏幕适配



### Android当中的一些尺寸单位

> **Android在运行的时候会自动将dp/dip/sp为单位的尺寸转换为以像素单位的值**。

#### **手机尺寸**

屏幕对角线的长度，单位为**英寸**（2.54cm）。

#### **屏幕分辨率**

屏幕能够显示的**像素数量**，一般用**横向数量*纵向数量**来表达。

- 单位：px（pixel），1px=1个像素点
- Android手机常见的分辨率：320x480、480x800、720x1280、1080x1920、 1080x2340

#### **屏幕像素密度ppi**

pixels per inch，即ppi，也就是**每英寸屏幕显示的像素数**，像素密度越大，显示的画面细节就越丰富。

像素密度= {((长度像素数-1)^2+(宽度像素数-1)^2]^(1/2)}/屏幕尺寸。(**对角线上每英寸显示的像素数**)

#### **DPI**

Dots Per Inch，每英寸所打印的点数或线数的缩写，用来表示打印机打印分辨率，但有时也会**用dpi来代指ppi**。

dpi(dot per inch)**屏幕像素密度**，指的是每英寸多少像素 px(pixels)。（可以认为和ppi差不多）



#### **手机的密度**

Density，以**160ppi**为基准，即**像素密度为160时Density为1**。

| 密度类型 | 屏幕像素密度 | 换算手机密度Density  |
| :------- | ------------ | -------------------- |
| ldpi     | 120dpi       | 0.75（1dp = 0.75px） |
| **mdpi** | 160dpi       | 1.0（1dp = 1px）     |
| hdpi     | 240dpi       | 1.5（1dp = 1.5px）   |
| xhdpi    | 320dpi       | 2.0（1dp = 2px）     |
|          |              |                      |

#### **像素px**

pixels，像素，1px的长度就对应了屏幕一个像素点的大小。不同的手机显示的大小可能是不一样的。

#### **设备无关dp/dip**

dp 与 dip(device independent pixels)是一个意思，指的是**设备独立像素**，或者说**设备无关像素**。

1dp = (dpi/160)px

1dp = density px

1px = 1/density dp

也就是**用dp做单位，最终转换的像素数是有变化的**，例如1dp，如果是160dpi，就是1px；120dpi，就是0.75px；320dpi，就是2px。

最终的作用区别也就是，在尺寸不变的情况下：**以dp为单位，可以保证在不同屏幕像素密度的设备上显示相同的效果，在不同质量屏幕的手机上显示的大小不变**；而以px为单位的话，在差一点的手机上，也就是像素密度更小的情况下，显示的效果会变大，在好一点的手机上则会变小。所以**我们在布局文件中，除了字体大小以sp为单位，其它都以dp为单位就好**。

#### **可缩放像素sp**

scaled pixels（可缩放像素），主要用于字体大小的 ，与dp类似，但使用sp作为字体大小单位，**字体大小会随着系统的字体大小改变**，而dp作为单位的话就不会。

> 推荐使用12sp、14sp、18sp、22sp作为字体设置的大小，不推荐使用奇数和小数，容易造成**精度丢失**问题；小于12sp的字体会太小导致用户看不清



### 屏幕适配方案

#### **dp原生方案**

+ 不同分辨率的屏幕适配

  不同分辨率的设备（不同density），1dp的像素数量不一样的。但是所表示的物理长度是一样的（如160dp=1in）。dp单位的使用就意味着在这些同样尺寸但是不同分辨率的设备上看到的大小一样，此时各设备上显示的比例也就一致了。

+ ==dp方案没有解决的问题==

  🌰例子：

  > 屏幕分辨率为：1920*1080，屏幕尺寸为5吋的话，那么dpi为440。假设我们UI设计图是按屏幕宽度为360dp来设计的，那这样会存在什么问题呢？
  >
  > 在上述设备上，屏幕宽度其实为1080/(440/160)=392.7dp，也就是屏幕是比设计图要宽的。这种情况下， 即使使用dp也是无法在不同设备上显示为同样效果的。 同时还存在部分设备屏幕宽度不足360dp，这时就会导致按360dp宽度来开发实际显示不全的情况。

  而且上述屏幕尺寸、分辨率和像素密度的关系，很多设备并没有按此规则来实现， 因此dpi的值非常乱，没有规律可循，从而导致使用dp适配效果差强人意。

#### dimen基于px和dp的适配（宽高限定符和smallestWidth适配）

##### dimens基于dp的适配（smallestWidth限定符）

这种适配依据的是最小宽度限定符。指的是Android会识别屏幕可用高度和宽度的最小尺寸的dp值（其实就是手机的宽度值），然后根据识别到的结果去资源文件中寻找对应限定符的文件夹下的资源文件。这种机制和上文提到的宽高限定符适配原理上是一样的，都是系统通过特定的规则来选择对应的文件。

> 例子：小米5的dpi是480,横向像素是1080px，根据px=dp(dpi/160)，横向的dp值是1080/(480/160),也就是360dp,系统就会去寻找是否存在value-sw360dp的文件夹以及对应的资源文件。

+ 优点：

  smallestWidth限定符适配和宽高限定符适配最大的区别在于，有很好的容错机制，**如果没有value-sw360dp文件夹，系统会向下寻找，比如离360dp最近的只有value-sw350dp，那么Android就会选择value-sw350dp文件夹下面的资源文件**。这个特性就完美的解决了上文提到的宽高限定符的容错问题。

+ 缺点：

  + 侵入性强

  + Android 私人订制的原因，宽度方面参差不齐，不可能适配所有的手机。

  + 通过宽度限定符就近查找的原理，可以看出来匹配出来的大小不够准确。

  + 项目中增加很多文件夹，带来不便。

    

##### dimens基于px的适配 宽高限定符适配

据市面上手机分辨率占比分析，我们选定一个占比例值大的设为基准（如1280 * 720），然后其他分辨率据这个基准做适配。基准的意思（如320*480为基准）：宽为320，将任何分辨率的宽度分为320份，取值为x1到x320；长为480，将任何分辨率的高度分为480份，取值为y1到y480。

> 例子：对于800 * 480的分辨率设备来讲，需要在项目中values-800x480目录下的dimens.xml文件中的如下设置（当然了，可以通过工具自动生成）：
>
> ```xml
> <resources>
> <dimen name="x1">1.5px</dimen>
> <dimen name="x2">3.0px</dimen>
> <dimen name="x3">4.5px</dimen>
> <dimen name="x4">6.0px</dimen>
> <dimen name="x5">7.5px</dimen></pre>
> ```
>
> 可以看到x1 = 480 / 基准 = 480 / 320 = 1.5，它的意思就是同样的1px，在320 * 480分辨率的手机上是1px，在480 * 800的分辨率的手机上就是1.5px，px会根据我们指定的不同values文件夹自动适配为合适的大小。

+ 缺点：
  + 侵入性强
  + 需要精准命中资源文件才能适配，比如1920x1080的手机就一定要找到1920x1080的限定符，否则就只能用统一的默认的dimens文件了。而使用默认的尺寸的话，UI就很可能变形，简单说，就是**容错机制很差**。
  + Android不同分辨率的手机实在太多了，可能你说主流就可以，的确小公司主流就可以，淘宝这种App肯定不能只适配主流手机。控件在设计图上显示的大小以及控件之间的间隙在小分辨率和大分辨率手机上天壤之别，你会发现大屏幕手机上控件超级大。可能你会觉得正常，毕竟分辨率不同。但实际效果大的有些夸张。
  + 占据资源大：好几百KB，甚至多达1M或跟多。



#### ==修改变量==

通常下，我们只需要以宽或高一个维度去适配，比如我们Feed是上下滑动的，只需要保证在所有设备中宽的维度上显示一致即可，再比如一个不支持上下滑动的页面，那么需要保证在高这个维度上都显示一致，尤其不能存在某些设备上显示不全的情况。

- 支持dp和sp单位，控制迁移成本到最小。



相关文章

+ [Android 最全面的屏幕适配方案](https://juejin.cn/post/7000329806101348360#heading-18)
