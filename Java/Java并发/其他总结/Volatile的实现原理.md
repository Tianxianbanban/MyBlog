## Volatile的实现原理



对于volatile关键字修饰的变量，当对它进行写操作的时候，JVM会向CPU发送带有**Lock前缀**的指令，那么这个变量将被写回到系统内存当中。同时，为了防止在这种情况下，其他各处理器缓存当中的值还是旧值，也就是，在多处理器下，为了保证各个处理器的缓存是一致的，就会实现**缓存一致性协议**！每个处理器通过嗅探在总线上传播的数据来检查自己的缓存值是不是已经过期，当处理器发现自己缓存行对应的内存地址被修改，就会将当前处理器的缓存行设置为无效状态，当处理器对这个数据进行修改的时候，就会重新从系统内存当中把数据读到处理器缓存里面。

另外，volatile关键字通过**内存屏障**来防止指令被重排序。为了实现volatile的内存语义，编译器在生成字节码时，会在指令序列中插入内存屏障来禁止特定类型的处理器重排序。



**文章**

[彻底理解volatile](https://juejin.im/post/5ae9b41b518825670b33e6c4#heading-5)

